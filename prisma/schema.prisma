generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String    @id @default(uuid())
  email                 String    @unique
  password              String
  name                  String?
  phone                 String?
  role                  Role      @default(USER)
  civility              String?
  newsletterSubscribed  Boolean   @default(false)
  savedProducts         String[]
  orders                Order[]
  resetToken            String?
  resetTokenExpiry      DateTime?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

enum Role {
  USER
  ADMIN
}

model Product {
  id                 String          @id @default(uuid())
  name               String
  slug               String          @unique
  description        String          @db.Text
  shortDescription   String?         @db.Text
  price              Decimal         @db.Decimal(10, 2)
  category           String
  color              String
  images             String[]
  videoUrl           String?
  sizes              Json
  totalStock         Int             @default(0)
  lowStockThreshold  Int             @default(5)
  isVisible          Boolean         @default(true)
  sortOrder          Int             @default(0)
  productInfo        String?         @db.Text
  sizeFit            String?         @db.Text
  shippingInfo       String?         @db.Text
  careInfo           String?         @db.Text
  sizeChartImage     String?
  sizeChartType      String?
  sizeChartData      Json?
  seoTitle           String?
  seoDescription     String?
  seoKeywords        String?
  ogImage            String?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
}

model Category {
  id        String   @id @default(uuid())
  name      String   @unique
  slug      String   @unique
  videoUrl  String?
  isVisible Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id                String        @id @default(uuid())
  orderNumber       String        @unique
  userId            String?
  user              User?         @relation(fields: [userId], references: [id])
  customerEmail     String
  customerName      String
  customerPhone     String
  items             Json
  totalPrice        Decimal       @db.Decimal(10, 2)
  paymentId         String?
  paymentStatus     PaymentStatus @default(PENDING)
  gopayData         Json?
  shippingMethod    String        @default("zasilkovna")
  zasilkovnaId      String?
  zasilkovnaName    String?
  packetaPacketId   String?
  packetaError      String?       @db.Text
  trackingNumber    String?
  status            OrderStatus   @default(PENDING)
  invoiceUrl        String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum OrderStatus {
  PENDING
  PAID
  PROCESSING
  SHIPPED
  COMPLETED
  CANCELLED
}

model PromoCode {
  id              String   @id @default(uuid())
  code            String   @unique
  discountType    String
  discountValue   Decimal  @db.Decimal(10, 2)
  minOrderAmount  Decimal? @db.Decimal(10, 2)
  maxUses         Int?
  currentUses     Int      @default(0)
  validFrom       DateTime
  validUntil      DateTime
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model NewsletterSubscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  createdAt DateTime @default(now())
}

model EmailCampaign {
  id                    String    @id @default(uuid())
  name                  String
  subject               String
  content               String    @db.Text
  targetAudience        String    @default("all")
  recipientEmails       String[]  @default([])
  status                String    @default("draft")
  sentAt                DateTime?
  openedCount           Int       @default(0)
  sentCount             Int       @default(0)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

model PricingRule {
  id                    String    @id @default(uuid())
  name                  String
  ruleType              String
  discountType          String
  discountValue         Decimal   @db.Decimal(10, 2)
  minQuantity           Int?
  minOrderAmount        Decimal?  @db.Decimal(10, 2)
  applicableCategories  String[]  @default([])
  applicableProducts    String[]  @default([])
  validFrom             DateTime
  validUntil            DateTime
  customerGroups        String[]  @default([])
  isActive              Boolean   @default(true)
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

model Settings {
  id                  String   @id @default(uuid())
  gopayGoId           String?
  gopayClientId       String?
  gopayClientSecret   String?
  gopayEnvironment    String   @default("test")
  zasilkovnaApiKey    String?
  resendApiKey        String?
  senderEmail         String   @default("objednavky@ufosport.cz")
  shippingCost        Decimal  @db.Decimal(10, 2) @default(79)
  termsAndConditions  String?  @db.Text
  updatedAt           DateTime @updatedAt
}

model Media {
  id            String      @id @default(uuid())
  filename      String
  originalName  String
  url           String
  publicId      String
  resourceType  MediaType
  format        String?
  size          Int
  width         Int?
  height        Int?
  duration      Float?
  tags          String[]    @default([])
  category      String?
  description   String?     @db.Text
  isActive      Boolean     @default(true)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
}

enum MediaType {
  IMAGE
  VIDEO
}
